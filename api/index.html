
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="Documentation for the qontrol software library">
      
      
        <meta name="author" content="Daniel Weiss">
      
      
        <link rel="canonical" href="http://dkweiss.net/qontrol/api/">
      
      
        <link rel="prev" href="../examples/Kerr_oscillator/">
      
      
        <link rel="next" href="../FAQ/">
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.6.22">
    
    
      
        <title>API - qontrol</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.84d31ad4.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="../_static/custom_css.css">
    
      <link rel="stylesheet" href="../css/ansi-colours.css">
    
      <link rel="stylesheet" href="../css/jupyter-cells.css">
    
      <link rel="stylesheet" href="../css/pandas-dataframe.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="amber">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#python-api" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="qontrol" class="md-header__button md-logo" aria-label="qontrol" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            qontrol
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="deep-purple" data-md-color-accent="amber"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="deep-purple" data-md-color-accent="amber"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      
      
        <label class="md-header__button md-icon" for="__search">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        </label>
        <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
      
    
    
      <div class="md-header__source">
        <a href="https://github.com/dkweiss31/qontrol" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    dkweiss31/qontrol
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href=".." class="md-tabs__link">
        
  
  
    
  
  Getting Started

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../examples/qubit/" class="md-tabs__link">
          
  
  
    
  
  Examples

        </a>
      </li>
    
  

      
        
  
  
  
    
  
  
    <li class="md-tabs__item md-tabs__item--active">
      <a href="./" class="md-tabs__link">
        
  
  
    
  
  API

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href="../FAQ/" class="md-tabs__link">
          
  
  
    
  
  Misc

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


  

<nav class="md-nav md-nav--primary md-nav--lifted md-nav--integrated" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="qontrol" class="md-nav__button md-logo" aria-label="qontrol" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54"/></svg>

    </a>
    qontrol
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/dkweiss31/qontrol" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    dkweiss31/qontrol
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Getting Started
    
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
        
          
          <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Examples
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_2">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/qubit/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Qubit
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/Kerr_oscillator/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Kerr Oscillator
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  
  <span class="md-ellipsis">
    API
    
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#optimization" class="md-nav__link">
    <span class="md-ellipsis">
      Optimization
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Optimization">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qontrol.optimize.optimize" class="md-nav__link">
    <span class="md-ellipsis">
      optimize
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#cost-functions" class="md-nav__link">
    <span class="md-ellipsis">
      Cost functions
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Cost functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qontrol.cost.incoherent_infidelity" class="md-nav__link">
    <span class="md-ellipsis">
      incoherent_infidelity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qontrol.cost.coherent_infidelity" class="md-nav__link">
    <span class="md-ellipsis">
      coherent_infidelity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qontrol.cost.propagator_infidelity" class="md-nav__link">
    <span class="md-ellipsis">
      propagator_infidelity
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qontrol.cost.forbidden_states" class="md-nav__link">
    <span class="md-ellipsis">
      forbidden_states
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qontrol.cost.control_area" class="md-nav__link">
    <span class="md-ellipsis">
      control_area
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qontrol.cost.control_norm" class="md-nav__link">
    <span class="md-ellipsis">
      control_norm
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qontrol.cost.custom_control_cost" class="md-nav__link">
    <span class="md-ellipsis">
      custom_control_cost
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qontrol.cost.custom_cost" class="md-nav__link">
    <span class="md-ellipsis">
      custom_cost
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#models" class="md-nav__link">
    <span class="md-ellipsis">
      Models
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Models">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qontrol.model.sesolve_model" class="md-nav__link">
    <span class="md-ellipsis">
      sesolve_model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qontrol.model.mesolve_model" class="md-nav__link">
    <span class="md-ellipsis">
      mesolve_model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qontrol.model.sepropagator_model" class="md-nav__link">
    <span class="md-ellipsis">
      sepropagator_model
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qontrol.model.mepropagator_model" class="md-nav__link">
    <span class="md-ellipsis">
      mepropagator_model
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#custom-plotting" class="md-nav__link">
    <span class="md-ellipsis">
      Custom Plotting
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Custom Plotting">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#qontrol.plot.plot_costs" class="md-nav__link">
    <span class="md-ellipsis">
      plot_costs
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qontrol.plot.get_controls" class="md-nav__link">
    <span class="md-ellipsis">
      get_controls
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qontrol.plot.plot_controls" class="md-nav__link">
    <span class="md-ellipsis">
      plot_controls
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qontrol.plot.plot_fft" class="md-nav__link">
    <span class="md-ellipsis">
      plot_fft
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qontrol.plot.plot_expects" class="md-nav__link">
    <span class="md-ellipsis">
      plot_expects
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#qontrol.plot.custom_plotter" class="md-nav__link">
    <span class="md-ellipsis">
      custom_plotter
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#file-utilities" class="md-nav__link">
    <span class="md-ellipsis">
      File utilities
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
      
        
      
    
    
    
      
      
        
      
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  
  <span class="md-ellipsis">
    Misc
    
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Misc
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../FAQ/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    FAQ
    
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../contributing/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    Contributing
    
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  



<h1 id="python-api">Python API<a class="headerlink" href="#python-api" title="Permanent link">¤</a></h1>
<p>The <strong>qontrol</strong> Python API consists of the function <strong>optimize</strong> which performs optimal control, and various models
that can be optimized including <strong>SESolveModel</strong> and <strong>MESolveModel</strong>. There are additionally various utility functions
and classes that help to define an optimization routine (cost functions, file input output, options, etc.)</p>
<h2 id="optimization">Optimization<a class="headerlink" href="#optimization" title="Permanent link">¤</a></h2>


<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="qontrol.optimize.optimize" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">optimize</span><span class="p">(</span><span class="n">parameters</span><span class="p">:</span> <span class="n">ArrayLike</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">,</span> <span class="n">costs</span><span class="p">:</span> <span class="n">Cost</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">optimizer</span><span class="p">:</span> <span class="n">GradientTransformation</span> <span class="o">=</span> <span class="n">optax</span><span class="o">.</span><span class="n">adam</span><span class="p">(</span><span class="mf">0.0001</span><span class="p">,</span> <span class="n">b1</span><span class="o">=</span><span class="mf">0.99</span><span class="p">,</span> <span class="n">b2</span><span class="o">=</span><span class="mf">0.99</span><span class="p">),</span> <span class="n">plotter</span><span class="p">:</span> <span class="n">Plotter</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="p">:</span> <span class="n">Method</span> <span class="o">=</span> <span class="n">Tsit5</span><span class="p">(),</span> <span class="n">gradient</span><span class="p">:</span> <span class="n">Gradient</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">dq_options</span><span class="p">:</span> <span class="n">dq</span><span class="o">.</span><span class="n">Options</span> <span class="o">=</span> <span class="n">dq</span><span class="o">.</span><span class="n">Options</span><span class="p">(),</span> <span class="n">opt_options</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">filepath</span><span class="p">:</span> <span class="nb">str</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span> <span class="o">|</span> <span class="nb">dict</span></code>

<a href="#qontrol.optimize.optimize" class="headerlink" title="Permanent link">¤</a></h4>


    <div class="doc doc-contents ">

        <p>Perform gradient descent to optimize Hamiltonian parameters.</p>
<p>This function takes as input <code>parameters</code> which parametrize a <code>model</code> when called
performs time-dynamics simulations using Dynamiqs. How to update <code>parameters</code> is
encoded in the list of cost functions <code>costs</code> that contains e.g. infidelity
contributions, pulse amplitude penalties, etc.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>parameters</code></b>
              (<code><span title="jaxtyping.ArrayLike">ArrayLike</span> | <span title="dict">dict</span></code>)
          –
          <div class="doc-md-description">
            <p>parameters to optimize over that are used to define the Hamiltonian
and control times.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>costs</code></b>
              (<code><span title="qontrol.cost.Cost">Cost</span></code>)
          –
          <div class="doc-md-description">
            <p>List of cost functions used to perform the optimization.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>model</code></b>
              (<code><span title="qontrol.model.Model">Model</span></code>)
          –
          <div class="doc-md-description">
            <p>Model that is called at each iteration step.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>optimizer</code></b>
              (<code><span title="optax.GradientTransformation">GradientTransformation</span></code>, default:
                  <code><span title="optax.adam">adam</span>(0.0001, b1=0.99, b2=0.99)</code>
)
          –
          <div class="doc-md-description">
            <p>optax optimizer to use
for gradient descent. Defaults to the Adam optimizer.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>plotter</code></b>
              (<code><span title="qontrol.plot.Plotter">Plotter</span> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Plotter for monitoring the optimization.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>method</code></b>
              (<code><span title="dynamiqs.method.Method">Method</span></code>, default:
                  <code><span title="dynamiqs.method.Tsit5">Tsit5</span>()</code>
)
          –
          <div class="doc-md-description">
            <p>Method passed to Dynamiqs.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>gradient</code></b>
              (<code><span title="dynamiqs.gradient.Gradient">Gradient</span> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Gradient passed to Dynamiqs.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>filepath</code></b>
              (<code><span title="str">str</span> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Filepath of where to save optimization results.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>dq_options </code></b>
          –
          <div class="doc-md-description">
            <p>Options for the Dynamiqs integrator.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>opt_options</code></b>
              (<code><span title="dict">dict</span> | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Options for grape optimization.</p>
<details class="info">
<summary>Detailed <code>opt_options</code> API</summary>
<ul>
<li><code>verbose</code> (<code>bool</code>, default: <code>True</code>): If <code>True</code>, the optimizer will
    print out the infidelity at each epoch step to track the progress of
    the optimization.</li>
<li><code>ignore_termination</code> (<code>bool</code>, default: <code>False</code>): Whether to ignore the
    various termination conditions</li>
<li><code>all_costs</code> (<code>bool</code>, default: <code>True</code>): Whether or not all costs must
    be below their targets for early termination of the optimizer. If
    <code>False</code>, the optimization terminates if only one cost function is
    below the target (typically infidelity).</li>
<li><code>epochs</code> (<code>int</code>, default: <code>2000</code>): Number of optimization epochs.</li>
<li><code>plot</code> (<code>bool</code>, default: <code>True</code>): Whether to plot the results during
    the optimization (for the epochs where results are plotted,
    necessarily suffer a time penalty).</li>
<li><code>plot_period</code> (<code>int</code>, default: <code>30</code>): If plot is <code>True</code>, plot every
    <code>plot_period</code>.</li>
<li><code>save_period</code> (<code>int</code>, default: <code>30</code>): If a filepath is provided, save
    every <code>save_period</code>.</li>
<li><code>xtol</code> (<code>float</code>, default: <code>1e-8</code>): Terminate the optimization if the
    parameters are not being updated.</li>
<li><code>ftol</code> (<code>float</code>, default: <code>1e-8</code>): Terminate the optimization if the
    cost function is not changing above this level.</li>
<li><code>gtol</code> (<code>float</code>, default: <code>1e-8</code>): Terminate the optimization if the
    norm of the gradient falls below this level.</li>
</ul>
</details>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="jax.Array">Array</span> | <span title="dict">dict</span></code>
          –
          <div class="doc-md-description">
            <p>Optimized parameters from the final timestep.</p>
          </div>
        </li>
    </ul>


    </div>

</div>



  </div>

    </div>

</div><h2 id="cost-functions">Cost functions<a class="headerlink" href="#cost-functions" title="Permanent link">¤</a></h2>


<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="qontrol.cost.incoherent_infidelity" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">incoherent_infidelity</span><span class="p">(</span><span class="n">target_states</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">QArrayLike</span><span class="p">],</span> <span class="n">cost_multiplier</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">target_cost</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.005</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">IncoherentInfidelity</span></code>

<a href="#qontrol.cost.incoherent_infidelity" class="headerlink" title="Permanent link">¤</a></h4>


    <div class="doc doc-contents ">

        <p>Instantiate the cost function for calculating infidelity incoherently.</p>
<p>This fidelity is defined as
$$
    F_{\rm incoherent} = \sum_{k}|\langle\psi_{t}^{k}|\psi_{i}^{k}(T)\rangle|^2,
$$
where the states at the end of the pulse are <span class="arithmatex">\(|\psi_{i}^{k}(T)\rangle\)</span> and the
target states are <span class="arithmatex">\(|\psi_{t}^{k}\rangle\)</span>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>target_states</code></b>
              (<code><span title="list">list</span>[<span title="dynamiqs.QArrayLike">QArrayLike</span>]</code>)
          –
          <div class="doc-md-description">
            <p><em>Shape of QArrays = (s, n, 1) or (s, n, n)</em>. Target states for
the initial states passed to <code>optimize</code>. If performing master-equation
optimization, the target states should be passed as a list of density
matrices.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>cost_multiplier</code></b>
              (<code><span title="float">float</span></code>, default:
                  <code>1.0</code>
)
          –
          <div class="doc-md-description">
            <p>Weight for this cost function relative to other cost
functions.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>target_cost</code></b>
              (<code><span title="float">float</span></code>, default:
                  <code>0.005</code>
)
          –
          <div class="doc-md-description">
            <p>Target value for this cost function. If options.all_costs
is True, the optimization terminates early if all cost functions fall below
their target values. If options.all_costs is False, the optimization
terminates if only one cost function falls below its target value.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="qontrol.cost.IncoherentInfidelity">IncoherentInfidelity</span></code>
          –
          <div class="doc-md-description">
            <p>Callable object that returns the incoherent infidelity and whether the
infidelity is below the target value.</p>
          </div>
        </li>
    </ul>


    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="qontrol.cost.coherent_infidelity" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">coherent_infidelity</span><span class="p">(</span><span class="n">target_states</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">QArrayLike</span><span class="p">],</span> <span class="n">cost_multiplier</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">target_cost</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.005</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CoherentInfidelity</span></code>

<a href="#qontrol.cost.coherent_infidelity" class="headerlink" title="Permanent link">¤</a></h4>


    <div class="doc doc-contents ">

        <p>Instantiate the cost function for calculating infidelity coherently.</p>
<p>This fidelity is defined as
$$
    F_{\rm coherent} = |\sum_{k}\langle\psi_{t}^{k}|\psi_{i}^{k}(T)\rangle|^2,
$$
where the states at the end of the pulse are <span class="arithmatex">\(|\psi_{i}^{k}(T)\rangle\)</span> and the
target states are <span class="arithmatex">\(|\psi_{t}^{k}\rangle\)</span>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>target_states</code></b>
              (<code><span title="list">list</span>[<span title="dynamiqs.QArrayLike">QArrayLike</span>]</code>)
          –
          <div class="doc-md-description">
            <p><em>Shape = (s, n, 1) or (s, n, n)</em>. Target states for
the initial states passed to <code>optimize</code>. If performing master-equation
optimization, the target states should be passed as a list of density
matrices.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>cost_multiplier</code></b>
              (<code><span title="float">float</span></code>, default:
                  <code>1.0</code>
)
          –
          <div class="doc-md-description">
            <p>Weight for this cost function relative to other cost functions.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>target_cost</code></b>
              (<code><span title="float">float</span></code>, default:
                  <code>0.005</code>
)
          –
          <div class="doc-md-description">
            <p>Target value for this cost function. If options.all_costs
is True, the optimization terminates early if all cost functions fall below
their target values. If options.all_costs is False, the optimization
terminates if only one cost function falls below its target value.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="qontrol.cost.CoherentInfidelity">CoherentInfidelity</span></code>
          –
          <div class="doc-md-description">
            <p>Callable object that returns the coherent infidelity and whether the infidelity
is below the target value.</p>
          </div>
        </li>
    </ul>


    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="qontrol.cost.propagator_infidelity" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">propagator_infidelity</span><span class="p">(</span><span class="n">target_unitary</span><span class="p">:</span> <span class="n">QArrayLike</span><span class="p">,</span> <span class="n">cost_multiplier</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">target_cost</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.005</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PropagatorInfidelity</span></code>

<a href="#qontrol.cost.propagator_infidelity" class="headerlink" title="Permanent link">¤</a></h4>


    <div class="doc doc-contents ">

        <p>Instantiate the cost function for calculating infidelity of a propagator.</p>
<p>This fidelity is defined as
$$
    F_{\rm propagator} = \Tr(U_{t}^{\dagger} U/d)^2,
$$
where the propagator at the end of the pulse is <span class="arithmatex">\(U\)</span>, the dimension of the system is
<span class="arithmatex">\(d\)</span> and the target unitary <span class="arithmatex">\(U_{t}\)</span>.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>target_unitary</code></b>
              (<code><span title="dynamiqs.QArrayLike">QArrayLike</span></code>)
          –
          <div class="doc-md-description">
            <p><em>Shape = (n,n)</em>. Target unitary for the initial states passed
to <code>optimize</code>.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>cost_multiplier</code></b>
              (<code><span title="float">float</span></code>, default:
                  <code>1.0</code>
)
          –
          <div class="doc-md-description">
            <p>Weight for this cost function relative to other cost
functions.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>target_cost</code></b>
              (<code><span title="float">float</span></code>, default:
                  <code>0.005</code>
)
          –
          <div class="doc-md-description">
            <p>Target value for this cost function. If options.all_costs
is True, the optimization terminates early if all cost functions fall below
their target values. If options.all_costs is False, the optimization
terminates if only one cost function falls below its target value.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="qontrol.cost.PropagatorInfidelity">PropagatorInfidelity</span></code>
          –
          <div class="doc-md-description">
            <p>Callable object that returns the propagator infidelity and whether the
infidelity is below the target value.</p>
          </div>
        </li>
    </ul>


    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="qontrol.cost.forbidden_states" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">forbidden_states</span><span class="p">(</span><span class="n">forbidden_states_list</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">QArrayLike</span><span class="p">],</span> <span class="n">cost_multiplier</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">target_cost</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ForbiddenStates</span></code>

<a href="#qontrol.cost.forbidden_states" class="headerlink" title="Permanent link">¤</a></h4>


    <div class="doc doc-contents ">

        <p>Instantiate the cost function for penalizing forbidden-state occupation.</p>
<p>This cost function is defined as
$$
    C=\sum_{k}\sum_{f}\int_{0}^{T}dt|\langle\psi_{f}^{k}|\psi_{i}^{k}(t)\rangle|^2,
$$
where <span class="arithmatex">\(|\psi_{i}^{k}(t)\rangle\)</span> is the <span class="arithmatex">\(k^{\rm th}\)</span> initial state propagated to time
<span class="arithmatex">\(t\)</span> and |\psi_{f}^{k}\rangle is a forbidden state for the <span class="arithmatex">\(k^{\rm th}\)</span> initial
state.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>forbidden_states_list</code></b>
              (<code><span title="list">list</span>[<span title="dynamiqs.QArrayLike">QArrayLike</span>]</code>)
          –
          <div class="doc-md-description">
            <p>Shape of QArrays = (n, 1) or (n, n)_.
A list of forbidden states for each initial state (indexed by s). The inner
lists need not all be of the same shape, for instance if some initial states
have more forbidden states than others. The array is eventually reshaped to
have shape (s, 1, f, n, 1) or (s, 1, f, n, n) (for <code>sesolve</code> or <code>mesolve</code>,
respectively) where s is the number of initial states, f is the length of
the longest forbidden-state list (with zero-padding for meaningless entries)
and 1 is an added batch dimension for eventually batching over tsave.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>cost_multiplier</code></b>
              (<code><span title="float">float</span></code>, default:
                  <code>1.0</code>
)
          –
          <div class="doc-md-description">
            <p>Weight for this cost function relative to other cost functions.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>target_cost</code></b>
              (<code><span title="float">float</span></code>, default:
                  <code>0.0</code>
)
          –
          <div class="doc-md-description">
            <p>Target value for this cost function. If options.all_costs is True,
the optimization terminates early if all cost functions fall below their
target values. If options.all_costs is False, the optimization terminates if
only one cost function falls below its target value.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="qontrol.cost.ForbiddenStates">ForbiddenStates</span></code>
          –
          <div class="doc-md-description">
            <p>Callable object that returns the forbidden-state cost and whether the cost is
below the target value.</p>
          </div>
        </li>
    </ul>


    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="qontrol.cost.control_area" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">control_area</span><span class="p">(</span><span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">,</span> <span class="n">cost_multiplier</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">target_cost</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ControlCostArea</span></code>

<a href="#qontrol.cost.control_area" class="headerlink" title="Permanent link">¤</a></h4>


    <div class="doc doc-contents ">

        <p>Control area cost function.</p>
<p>Penalize the area under the pulse curves according to
$$
    C = \sum_{j}\int_{0}^{T}\Omega_{j}(t)dt,
$$
where the <span class="arithmatex">\(\Omega_{j}\)</span> are the individual controls and <span class="arithmatex">\(T\)</span> is the pulse time.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>threshold</code></b>
              (<code><span title="float">float</span></code>, default:
                  <code>0.0</code>
)
          –
          <div class="doc-md-description">
            <p>Threshold to use for penalizing areas above this value in absolute
magnitude.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>cost_multiplier</code></b>
              (<code><span title="float">float</span></code>, default:
                  <code>1.0</code>
)
          –
          <div class="doc-md-description">
            <p>Weight for this cost function relative to other cost functions.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>target_cost</code></b>
              (<code><span title="float">float</span></code>, default:
                  <code>0.0</code>
)
          –
          <div class="doc-md-description">
            <p>Target value for this cost function. If options.all_costs is True,
the optimization terminates early if all cost functions fall below their
target values. If options.all_costs is False, the optimization terminates
if only one cost function falls below its target value.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="qontrol.cost.ControlCostArea">ControlCostArea</span></code>
          –
          <div class="doc-md-description">
            <p>Callable object that returns the control-area cost and whether the cost is
below the target value.</p>
          </div>
        </li>
    </ul>


    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="qontrol.cost.control_norm" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">control_norm</span><span class="p">(</span><span class="n">threshold</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">cost_multiplier</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">target_cost</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ControlCostNorm</span></code>

<a href="#qontrol.cost.control_norm" class="headerlink" title="Permanent link">¤</a></h4>


    <div class="doc doc-contents ">

        <p>Control norm cost function.</p>
<p>Penalize the norm of the controls above some threshold according to
$$
    C = \sum_{j}\int_{0}^{T}ReLU(|\Omega_{j}(t)|-\Omega_{max})dt,
$$
where the <span class="arithmatex">\(\Omega_{j}\)</span> are the individual controls, <span class="arithmatex">\(T\)</span> is the pulse time
and <span class="arithmatex">\(\Omega_{max}\)</span> is the threshold.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>threshold</code></b>
              (<code><span title="float">float</span></code>)
          –
          <div class="doc-md-description">
            <p>Threshold to use for penalizing amplitudes above this value in
absolute magnitude.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>cost_multiplier</code></b>
              (<code><span title="float">float</span></code>, default:
                  <code>1.0</code>
)
          –
          <div class="doc-md-description">
            <p>Weight for this cost function relative to other cost functions.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>target_cost</code></b>
              (<code><span title="float">float</span></code>, default:
                  <code>0.0</code>
)
          –
          <div class="doc-md-description">
            <p>Target value for this cost function. If options.all_costs is True,
the optimization terminates early if all cost functions fall below their
target values. If options.all_costs is False, the optimization terminates
if only one cost function falls below its target value.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="qontrol.cost.ControlCostNorm">ControlCostNorm</span></code>
          –
          <div class="doc-md-description">
            <p>Callable object that returns the control-norm cost and whether the cost is
below the target value.</p>
          </div>
        </li>
    </ul>


    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="qontrol.cost.custom_control_cost" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">custom_control_cost</span><span class="p">(</span><span class="n">cost_fun</span><span class="p">:</span> <span class="nb">callable</span><span class="p">,</span> <span class="n">cost_multiplier</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">target_cost</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CustomControlCost</span></code>

<a href="#qontrol.cost.custom_control_cost" class="headerlink" title="Permanent link">¤</a></h4>


    <div class="doc doc-contents ">

        <p>Cost function based on an arbitrary transformation of the controls.</p>
<p>Penalize the controls according to an arbitrary function <code>F</code>
$$
    C = \sum_{j}\int_{0}^{T}F(\Omega_{j}(t))dt,
$$</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>cost_fun</code></b>
              (<code><span title="callable">callable</span></code>)
          –
          <div class="doc-md-description">
            <p>Cost function which must have signature <code>(control_amp: Array) -&gt;
Array</code>.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>cost_multiplier</code></b>
              (<code><span title="float">float</span></code>, default:
                  <code>1.0</code>
)
          –
          <div class="doc-md-description">
            <p>Weight for this cost function relative to other cost functions.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>target_cost</code></b>
              (<code><span title="float">float</span></code>, default:
                  <code>0.0</code>
)
          –
          <div class="doc-md-description">
            <p>Target value for this cost function. If options.all_costs is True,
the optimization terminates early if all cost functions fall below their
target values. If options.all_costs is False, the optimization terminates if
only one cost function falls below its target value.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="qontrol.cost.CustomControlCost">CustomControlCost</span></code>
          –
          <div class="doc-md-description">
            <p>Callable object that returns the cost for the custom function and whether the
cost is below the target value.</p>
          </div>
        </li>
    </ul>
        <details class="example">
<summary>Example: Penalize negative drive amplitudes</summary>
<div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">penalize_negative</span><span class="p">(</span><span class="n">control_amp</span><span class="p">:</span> <span class="n">jax</span><span class="o">.</span><span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">jax</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">jax</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="o">-</span><span class="n">control_amp</span><span class="p">)</span>


<span class="n">negative_amp_cost</span> <span class="o">=</span> <span class="n">ql</span><span class="o">.</span><span class="n">custom_control_cost</span><span class="p">(</span><span class="n">penalize_negative</span><span class="p">)</span>
</code></pre></div>
</details>


    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="qontrol.cost.custom_cost" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">custom_cost</span><span class="p">(</span><span class="n">cost_fun</span><span class="p">:</span> <span class="nb">callable</span><span class="p">,</span> <span class="n">cost_multiplier</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">target_cost</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">CustomCost</span></code>

<a href="#qontrol.cost.custom_cost" class="headerlink" title="Permanent link">¤</a></h4>


    <div class="doc doc-contents ">

        <p>A custom cost function.</p>
<p>In many (most!) cases, the user may want to add a cost function to their
optimization that is not included in the hardcoded set of available cost functions.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>cost_fun</code></b>
              (<code><span title="callable">callable</span></code>)
          –
          <div class="doc-md-description">
            <p>Cost function which must have signature
<code>(result: dq.SolveResult, H: dq.TimeQArray, parameters: dict | Array) -&gt;
Array</code>.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>cost_multiplier</code></b>
              (<code><span title="float">float</span></code>, default:
                  <code>1.0</code>
)
          –
          <div class="doc-md-description">
            <p>Weight for this cost function relative to other cost functions.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>target_cost</code></b>
              (<code><span title="float">float</span></code>, default:
                  <code>0.0</code>
)
          –
          <div class="doc-md-description">
            <p>Target value for this cost function. If options.all_costs
is True, the optimization terminates early if all cost functions fall below
their target values. If options.all_costs is False, the optimization
terminates if only one cost function falls below its target value.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="qontrol.cost.CustomCost">CustomCost</span></code>
          –
          <div class="doc-md-description">
            <p>Callable object that returns the cost for the custom function.</p>
          </div>
        </li>
    </ul>
        <details class="example">
<summary>Example: Penalize an expectation value</summary>
<p>Let's imagine we want to penalize the value of some expectation value at the
final time in <code>tsave</code>.</p>
<p><div class="highlight"><pre><span></span><code><span class="k">def</span><span class="w"> </span><span class="nf">penalize_expect</span><span class="p">(</span>
    <span class="n">result</span><span class="p">:</span> <span class="n">SolveResult</span><span class="p">,</span> <span class="n">H</span><span class="p">:</span> <span class="n">TimeQArray</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="nb">dict</span> <span class="o">|</span> <span class="n">Array</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Array</span><span class="p">:</span>
    <span class="c1"># 0 is the index of the operator, -1 is the time index</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">jnp</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">expects</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">]))</span>


<span class="n">expect_cost</span> <span class="o">=</span> <span class="n">ql</span><span class="o">.</span><span class="n">custom_cost</span><span class="p">(</span><span class="n">penalize_expect</span><span class="p">)</span>
</code></pre></div>
Then <code>expect_cost</code> can be added to the other utilized cost functions. The only
thing happening under the hood is that the <code>penalize_expect</code> function is passed
to <code>jax.tree_util.Partial</code> to enable it to be passed through jitted functions
without issue.</p>
</details>


    </div>

</div>



  </div>

    </div>

</div><h2 id="models">Models<a class="headerlink" href="#models" title="Permanent link">¤</a></h2>


<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="qontrol.model.sesolve_model" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">sesolve_model</span><span class="p">(</span><span class="n">H_function</span><span class="p">:</span> <span class="nb">callable</span><span class="p">,</span> <span class="n">psi0</span><span class="p">:</span> <span class="n">QArrayLike</span><span class="p">,</span> <span class="n">tsave_or_function</span><span class="p">:</span> <span class="n">ArrayLike</span> <span class="o">|</span> <span class="nb">callable</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exp_ops</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SESolveModel</span></code>

<a href="#qontrol.model.sesolve_model" class="headerlink" title="Permanent link">¤</a></h4>


    <div class="doc doc-contents ">

        <p>Instantiate sesolve model.</p>
<p>Here we instantiate the model that is called at each step of the optimization
iteration, returning a tuple of the result of calling <code>sesolve</code> as well as the
Hamiltonian evaluated at the parameter values.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>H_function</code></b>
              (<code><span title="callable">callable</span></code>)
          –
          <div class="doc-md-description">
            <p>function specifying how to update the Hamiltonian</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>psi0</code></b>
              (<code><span title="dynamiqs.QArrayLike">QArrayLike</span></code>)
          –
          <div class="doc-md-description">
            <p><em>Shape = (..., n, 1)</em>. Initial states.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>tsave_or_function</code></b>
              (<code><span title="jaxtyping.ArrayLike">ArrayLike</span> | <span title="callable">callable</span></code>)
          –
          <div class="doc-md-description">
            <p><em>If ArrayLike, then Shape = (ntsave,)</em>. Either an array
of times passed to <code>sesolve</code> or a method specifying how to update the times
that are passed to <code>sesolve</code>.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>exp_ops</code></b>
              (<code><span title="list">list</span>[<span title="jaxtyping.ArrayLike">ArrayLike</span>] | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Operators to calculate expectation values of, in case some of the cost
functions depend on the value of certain expectation values.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="qontrol.model.SESolveModel">SESolveModel</span></code>
          –
          <div class="doc-md-description">
            <p>Model that when called with the parameters we optimize over as argument returns
the results of <code>sesolve</code> as well as the updated Hamiltonian.</p>
          </div>
        </li>
    </ul>
        <details class="example">
<summary>Piecewise-constant control</summary>
<p><div class="highlight"><pre><span></span><code><span class="n">tsave</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">11.0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">psi0</span> <span class="o">=</span> <span class="p">[</span><span class="n">dq</span><span class="o">.</span><span class="n">basis</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">0</span><span class="p">)]</span>
<span class="n">H1s</span> <span class="o">=</span> <span class="p">[</span><span class="n">dq</span><span class="o">.</span><span class="n">sigmax</span><span class="p">(),</span> <span class="n">dq</span><span class="o">.</span><span class="n">sigmay</span><span class="p">()]</span>


<span class="k">def</span><span class="w"> </span><span class="nf">H_pwc</span><span class="p">(</span><span class="n">values</span><span class="p">:</span> <span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dq</span><span class="o">.</span><span class="n">TimeQArray</span><span class="p">:</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">dq</span><span class="o">.</span><span class="n">sigmaz</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">_H1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">H1s</span><span class="p">):</span>
        <span class="n">H</span> <span class="o">+=</span> <span class="n">dq</span><span class="o">.</span><span class="n">pwc</span><span class="p">(</span><span class="n">tsave</span><span class="p">,</span> <span class="n">values</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">_H1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">H</span>


<span class="n">sesolve_model</span> <span class="o">=</span> <span class="n">ql</span><span class="o">.</span><span class="n">sesolve_model</span><span class="p">(</span><span class="n">H_pwc</span><span class="p">,</span> <span class="n">psi0</span><span class="p">,</span> <span class="n">tsave</span><span class="p">)</span>
</code></pre></div>
See for example <a href="../examples/qubit">this tutorial</a>.</p>
</details>
<details class="example">
<summary>Spline control</summary>
<p>In more complex cases, we can imagine that the optimized parameters
are the control points fed into a spline, and additionally the control
times themselves are optimized.
<div class="highlight"><pre><span></span><code><span class="n">init_drive_params_topt</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;dp&#39;</span><span class="p">:</span> <span class="o">-</span><span class="mf">0.001</span> <span class="o">*</span> <span class="n">jnp</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="nb">len</span><span class="p">(</span><span class="n">H1s</span><span class="p">),</span> <span class="nb">len</span><span class="p">(</span><span class="n">tsave</span><span class="p">))),</span>
    <span class="s1">&#39;t&#39;</span><span class="p">:</span> <span class="n">tsave</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span>
<span class="p">}</span>


<span class="k">def</span><span class="w"> </span><span class="nf">H_func_topt</span><span class="p">(</span><span class="n">t</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">drive_params_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dq</span><span class="o">.</span><span class="n">TimeQArray</span><span class="p">:</span>
    <span class="n">drive_params</span> <span class="o">=</span> <span class="n">drive_params_dict</span><span class="p">[</span><span class="s1">&#39;dp&#39;</span><span class="p">]</span>
    <span class="n">new_tsave</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">drive_params_dict</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">tsave</span><span class="p">))</span>
    <span class="n">drive_spline</span> <span class="o">=</span> <span class="n">_drive_spline</span><span class="p">(</span><span class="n">drive_params</span><span class="p">,</span> <span class="n">envelope</span><span class="p">,</span> <span class="n">new_tsave</span><span class="p">)</span>
    <span class="n">drive_amps</span> <span class="o">=</span> <span class="n">drive_spline</span><span class="o">.</span><span class="n">evaluate</span><span class="p">(</span><span class="n">t</span><span class="p">)</span>
    <span class="n">drive_Hs</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">einsum</span><span class="p">(</span><span class="s1">&#39;d,dij-&gt;ij&#39;</span><span class="p">,</span> <span class="n">drive_amps</span><span class="p">,</span> <span class="n">H1s</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">H0</span> <span class="o">+</span> <span class="n">drive_Hs</span>


<span class="k">def</span><span class="w"> </span><span class="nf">update_H_topt</span><span class="p">(</span><span class="n">drive_params_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dq</span><span class="o">.</span><span class="n">TimeQArray</span><span class="p">:</span>
    <span class="n">new_H</span> <span class="o">=</span> <span class="n">jtu</span><span class="o">.</span><span class="n">Partial</span><span class="p">(</span><span class="n">H_func_topt</span><span class="p">,</span> <span class="n">drive_params_dict</span><span class="o">=</span><span class="n">drive_params_dict</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">dq</span><span class="o">.</span><span class="n">timecallable</span><span class="p">(</span><span class="n">new_H</span><span class="p">)</span>


<span class="k">def</span><span class="w"> </span><span class="nf">update_tsave_topt</span><span class="p">(</span><span class="n">drive_params_dict</span><span class="p">:</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">jax</span><span class="o">.</span><span class="n">Array</span><span class="p">:</span>
    <span class="k">return</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">drive_params_dict</span><span class="p">[</span><span class="s1">&#39;t&#39;</span><span class="p">],</span> <span class="nb">len</span><span class="p">(</span><span class="n">tsave</span><span class="p">))</span>


<span class="n">se_t_opt_Kerr_model</span> <span class="o">=</span> <span class="n">ql</span><span class="o">.</span><span class="n">sesolve_model</span><span class="p">(</span><span class="n">update_H_topt</span><span class="p">,</span> <span class="n">psi0</span><span class="p">,</span> <span class="n">update_tsave_topt</span><span class="p">)</span>
</code></pre></div>
See for example
<a href="../examples/Kerr_oscillator#time-optimal-control">this tutorial</a>.</p>
</details>


    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="qontrol.model.mesolve_model" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">mesolve_model</span><span class="p">(</span><span class="n">H_function</span><span class="p">:</span> <span class="nb">callable</span><span class="p">,</span> <span class="n">jump_ops</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">QArrayLike</span> <span class="o">|</span> <span class="n">TimeQArray</span><span class="p">],</span> <span class="n">rho0</span><span class="p">:</span> <span class="n">QArrayLike</span><span class="p">,</span> <span class="n">tsave_or_function</span><span class="p">:</span> <span class="n">ArrayLike</span> <span class="o">|</span> <span class="nb">callable</span><span class="p">,</span> <span class="o">*</span><span class="p">,</span> <span class="n">exp_ops</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">ArrayLike</span><span class="p">]</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MESolveModel</span></code>

<a href="#qontrol.model.mesolve_model" class="headerlink" title="Permanent link">¤</a></h4>


    <div class="doc doc-contents ">

        <p>Instantiate mesolve model.</p>
<p>Here we instantiate the model called at each step of the optimization iteration,
returning a tuple of the result of calling <code>mesolve</code> as well as the Hamiltonian
evaluated at the parameter values.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>H_function</code></b>
              (<code><span title="callable">callable</span></code>)
          –
          <div class="doc-md-description">
            <p>function specifying how to update the Hamiltonian</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>jump_ops</code></b>
              (<code><span title="list">list</span>[<span title="dynamiqs.QArrayLike">QArrayLike</span> | <span title="dynamiqs.TimeQArray">TimeQArray</span>]</code>)
          –
          <div class="doc-md-description">
            <p><em>Each of QArray or TimeQArray is has shape = (...Lk, n, n))</em>. List of
jump operators.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>rho0</code></b>
              (<code><span title="dynamiqs.QArrayLike">QArrayLike</span></code>)
          –
          <div class="doc-md-description">
            <p><em>Shape = (..., n, n)</em>. Initial density matrices.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>tsave_or_function</code></b>
              (<code><span title="jaxtyping.ArrayLike">ArrayLike</span> | <span title="callable">callable</span></code>)
          –
          <div class="doc-md-description">
            <p><em>If ArrayLike, then Shape = (ntsave,)</em>. Either an array of
times passed to sesolve or a method specifying how to update the times that
are passed to <code>mesolve</code>.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>exp_ops</code></b>
              (<code><span title="list">list</span>[<span title="jaxtyping.ArrayLike">ArrayLike</span>] | None</code>, default:
                  <code>None</code>
)
          –
          <div class="doc-md-description">
            <p>Operators to calculate expectation values of, in case some of the cost
functions depend on the value of certain expectation values.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="qontrol.model.MESolveModel">MESolveModel</span></code>
          –
          <div class="doc-md-description">
            <p>Model that when called with the parameters we optimize over as argument returns
the results of <code>mesolve</code> as well as the updated Hamiltonian.</p>
          </div>
        </li>
    </ul>
        <details class="example">
<summary>Instantiating a MESolveModel</summary>
<p>Instantiating a <code>MESolveModel</code> is quite similar to instantiating an
<code>SESolveModel</code>, with the two differences being that we need to supply jump
operators, and the initial and target states should be specified as density
matrices. Continuing the last example from <code>sesolve_model</code>
<div class="highlight"><pre><span></span><code><span class="n">jump_ops</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.03</span> <span class="o">*</span> <span class="n">dq</span><span class="o">.</span><span class="n">sigmax</span><span class="p">()]</span>
<span class="n">me_initial_states</span> <span class="o">=</span> <span class="n">dq</span><span class="o">.</span><span class="n">todm</span><span class="p">(</span><span class="n">psi0</span><span class="p">)</span>
<span class="n">me_Kerr_model</span> <span class="o">=</span> <span class="n">ql</span><span class="o">.</span><span class="n">mesolve_model</span><span class="p">(</span>
    <span class="n">update_H_topt</span><span class="p">,</span> <span class="n">jump_ops</span><span class="p">,</span> <span class="n">me_initial_states</span><span class="p">,</span> <span class="n">update_tsave_topt</span>
<span class="p">)</span>
</code></pre></div>
See <a href="../examples/Kerr_oscillator#master-equation-optimization">this tutorial</a>
for example</p>
</details>


    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="qontrol.model.sepropagator_model" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">sepropagator_model</span><span class="p">(</span><span class="n">H_function</span><span class="p">:</span> <span class="nb">callable</span><span class="p">,</span> <span class="n">tsave_or_function</span><span class="p">:</span> <span class="n">ArrayLike</span> <span class="o">|</span> <span class="nb">callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">SEPropagatorModel</span></code>

<a href="#qontrol.model.sepropagator_model" class="headerlink" title="Permanent link">¤</a></h4>


    <div class="doc doc-contents ">

        <p>Instantiate sepropagator model.</p>
<p>Here we instantiate the model that is called at each step of the optimization
iteration, returning a tuple of the result of calling <code>sepropagator</code> as well as the
Hamiltonian evaluated at the parameter values.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>H_function</code></b>
              (<code><span title="callable">callable</span></code>)
          –
          <div class="doc-md-description">
            <p>function specifying how to update the Hamiltonian</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>tsave_or_function</code></b>
              (<code><span title="jaxtyping.ArrayLike">ArrayLike</span> | <span title="callable">callable</span></code>)
          –
          <div class="doc-md-description">
            <p><em>If ArrayLike, then Shape = (ntsave,)</em>. Either an array of
times passed to <code>sepropagator</code> or a method specifying how to update the
times that are passed to <code>sepropagator</code>.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="qontrol.model.SEPropagatorModel">SEPropagatorModel</span></code>
          –
          <div class="doc-md-description">
            <p>Model that when called with the parameters we optimize over as argument returns
the results of <code>sepropagator</code> as well as the updated Hamiltonian.</p>
          </div>
        </li>
    </ul>
        <details class="example">
<summary>Instantiating a <code>SEPropagatorModel</code></summary>
<div class="highlight"><pre><span></span><code><span class="n">tsave</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="mf">11.0</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
<span class="n">H1s</span> <span class="o">=</span> <span class="p">[</span><span class="n">dq</span><span class="o">.</span><span class="n">sigmax</span><span class="p">(),</span> <span class="n">dq</span><span class="o">.</span><span class="n">sigmay</span><span class="p">()]</span>


<span class="k">def</span><span class="w"> </span><span class="nf">H_pwc</span><span class="p">(</span><span class="n">values</span><span class="p">:</span> <span class="n">Array</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">dq</span><span class="o">.</span><span class="n">TimeQArray</span><span class="p">:</span>
    <span class="n">H</span> <span class="o">=</span> <span class="n">dq</span><span class="o">.</span><span class="n">sigmaz</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">_H1</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">H1s</span><span class="p">):</span>
        <span class="n">H</span> <span class="o">+=</span> <span class="n">dq</span><span class="o">.</span><span class="n">pwc</span><span class="p">(</span><span class="n">tsave</span><span class="p">,</span> <span class="n">values</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span> <span class="n">_H1</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">H</span>


<span class="n">sepropagator_model</span> <span class="o">=</span> <span class="n">ql</span><span class="o">.</span><span class="n">sepropagator_model</span><span class="p">(</span><span class="n">H_pwc</span><span class="p">,</span> <span class="n">tsave</span><span class="p">)</span>
</code></pre></div>
</details>


    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="qontrol.model.mepropagator_model" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">mepropagator_model</span><span class="p">(</span><span class="n">H_function</span><span class="p">:</span> <span class="nb">callable</span><span class="p">,</span> <span class="n">jump_ops</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">QArrayLike</span> <span class="o">|</span> <span class="n">TimeQArray</span><span class="p">],</span> <span class="n">tsave_or_function</span><span class="p">:</span> <span class="n">ArrayLike</span> <span class="o">|</span> <span class="nb">callable</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">MEPropagatorModel</span></code>

<a href="#qontrol.model.mepropagator_model" class="headerlink" title="Permanent link">¤</a></h4>


    <div class="doc doc-contents ">

        <p>Instantiate mepropagator model.</p>
<p>Here we instantiate the model that is called at each step of the optimization
iteration, returning a tuple of the result of calling <code>mepropagator</code> as well as the
Hamiltonian evaluated at the parameter values.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>H_function</code></b>
              (<code><span title="callable">callable</span></code>)
          –
          <div class="doc-md-description">
            <p>function specifying how to update the Hamiltonian</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>jump_ops</code></b>
              (<code><span title="list">list</span>[<span title="dynamiqs.QArrayLike">QArrayLike</span> | <span title="dynamiqs.TimeQArray">TimeQArray</span>]</code>)
          –
          <div class="doc-md-description">
            <p><em>Each of QArray or TimeQArray is has shape = (...Lk, n, n))</em>. List of
jump operators.</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
            <b><code>tsave_or_function</code></b>
              (<code><span title="jaxtyping.ArrayLike">ArrayLike</span> | <span title="callable">callable</span></code>)
          –
          <div class="doc-md-description">
            <p><em>If ArrayLike, then Shape = (ntsave,)</em>. Either an array of
times passed to <code>mepropagator</code> or a method specifying how to update the
times that are passed to <code>mepropagator</code>.</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="qontrol.model.MEPropagatorModel">MEPropagatorModel</span></code>
          –
          <div class="doc-md-description">
            <p>Model that when called with the parameters we optimize over as argument returns
the results of <code>mepropagator</code> as well as the updated Hamiltonian.</p>
          </div>
        </li>
    </ul>
        <details class="example">
<summary>Instantiating a <code>MEPropagatorModel</code></summary>
<p>Instantiating a <code>MEPropagatorModel</code> is quite similar to instantiating an
<code>SEPropagatorModel</code>, with the difference being that we need to supply jump
operators. Continuing the last example from <code>sepropagator_model</code>
<div class="highlight"><pre><span></span><code><span class="n">jump_ops</span> <span class="o">=</span> <span class="p">[</span><span class="mf">0.03</span> <span class="o">*</span> <span class="n">dq</span><span class="o">.</span><span class="n">sigmax</span><span class="p">()]</span>
<span class="n">mep_Kerr_model</span> <span class="o">=</span> <span class="n">ql</span><span class="o">.</span><span class="n">mepropagator_model</span><span class="p">(</span>
    <span class="n">update_H_topt</span><span class="p">,</span> <span class="n">jump_ops</span><span class="p">,</span> <span class="n">update_tsave_topt</span>
<span class="p">)</span>
</code></pre></div></p>
</details>


    </div>

</div>



  </div>

    </div>

</div><h2 id="custom-plotting">Custom Plotting<a class="headerlink" href="#custom-plotting" title="Permanent link">¤</a></h2>


<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">










  <div class="doc doc-children">










<div class="doc doc-object doc-function">


<h4 id="qontrol.plot.plot_costs" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">plot_costs</span><span class="p">(</span><span class="n">ax</span><span class="p">:</span> <span class="n">Axes</span><span class="p">,</span> <span class="n">costs</span><span class="p">:</span> <span class="n">Cost</span><span class="p">,</span> <span class="n">epoch</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">cost_values_over_epochs</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Axes</span></code>

<a href="#qontrol.plot.plot_costs" class="headerlink" title="Permanent link">¤</a></h4>


    <div class="doc doc-contents ">

        <p>Plot the evolution of the cost function values.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="qontrol.plot.get_controls" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">get_controls</span><span class="p">(</span><span class="n">H</span><span class="p">:</span> <span class="n">TimeQArray</span><span class="p">,</span> <span class="n">tsave</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]</span></code>

<a href="#qontrol.plot.get_controls" class="headerlink" title="Permanent link">¤</a></h4>


    <div class="doc doc-contents ">

        <p>Extract the Hamiltonian prefactors at the supplied times.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="qontrol.plot.plot_controls" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">plot_controls</span><span class="p">(</span><span class="n">ax</span><span class="p">:</span> <span class="n">Axes</span><span class="p">,</span> <span class="n">_expects</span><span class="p">:</span> <span class="n">Array</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">Array</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Axes</span></code>

<a href="#qontrol.plot.plot_controls" class="headerlink" title="Permanent link">¤</a></h4>


    <div class="doc doc-contents ">

        <p>Plot the Hamiltonian prefactors, usually corresponding to controls.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="qontrol.plot.plot_fft" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">plot_fft</span><span class="p">(</span><span class="n">ax</span><span class="p">:</span> <span class="n">Axes</span><span class="p">,</span> <span class="n">_expects</span><span class="p">:</span> <span class="n">Array</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">Array</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Axes</span></code>

<a href="#qontrol.plot.plot_fft" class="headerlink" title="Permanent link">¤</a></h4>


    <div class="doc doc-contents ">

        <p>Plot the fft of the Hamiltonian controls.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="qontrol.plot.plot_expects" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">plot_expects</span><span class="p">(</span><span class="n">ax</span><span class="p">:</span> <span class="n">Axes</span><span class="p">,</span> <span class="n">expects</span><span class="p">:</span> <span class="n">Array</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Model</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">Array</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Axes</span></code>

<a href="#qontrol.plot.plot_expects" class="headerlink" title="Permanent link">¤</a></h4>


    <div class="doc doc-contents ">

        <p>Plot the expectation values obtained from the time evolution.</p>


    </div>

</div>

<div class="doc doc-object doc-function">


<h4 id="qontrol.plot.custom_plotter" class="doc doc-heading">
<code class="doc-symbol doc-symbol-heading doc-symbol-function"></code>            <code class="highlight language-python"><span class="n">custom_plotter</span><span class="p">(</span><span class="n">plotting_functions</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Callable</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">Plotter</span></code>

<a href="#qontrol.plot.custom_plotter" class="headerlink" title="Permanent link">¤</a></h4>


    <div class="doc doc-contents ">

        <p>Instantiate a custom Plotter for tracking results during optimization.</p>
<p>This function returns a Plotter that can be passed to <code>optimize</code> to track the
progress of an optimization run. Note that the cost function values are always
plotted in the first panel and that there is no limit to the number of plots a user
can ask for: if more than four, additional plots will appear in a new row of four,
and so on.</p>


<p><span class="doc-section-title">Parameters:</span></p>
    <ul>
        <li class="doc-section-item field-body">
            <b><code>plotting_functions</code></b>
              (<code><span title="list">list</span>[<span title="collections.abc.Callable">Callable</span>]</code>)
          –
          <div class="doc-md-description">
            <p>list of functions that each return a plot
useful for tracking intermediate results, such as the value of the optimized
controls, fft of the controls, expectation values, etc. Each function must
have signature <code>example_plot_function(ax, expects, model, parameters)</code> where
<code>ax</code> is the <code>matplotlib.pyplot.Axes</code> instance where the results are plotted,
<code>expects</code> is of type dq.SolveResult.expects (which could be <code>None</code>), <code>model</code>
is of type <code>ql.Model</code> and <code>parameters</code> are the parameters being optimized.
Of course, some of these arguments may be unused for a particular plot (for
instance if we are plotting expectation values, we don't need access to
<code>parameters</code>).</p>
          </div>
        </li>
    </ul>


<p><span class="doc-section-title">Returns:</span></p>
    <ul>
        <li class="doc-section-item field-body">
              <code><span title="qontrol.plot.Plotter">Plotter</span></code>
          –
          <div class="doc-md-description">
            <p>Plotter whose <code>update_plots</code> method is repeatedly called during an optimization</p>
          </div>
        </li>
        <li class="doc-section-item field-body">
              <code><span title="qontrol.plot.Plotter">Plotter</span></code>
          –
          <div class="doc-md-description">
            <p>run.</p>
          </div>
        </li>
    </ul>
        <details class="example">
<summary>Example</summary>
<p>We plot the controls as well as the expectation values for two different initial
states
<div class="highlight"><pre><span></span><code><span class="kn">import</span><span class="w"> </span><span class="nn">dynamiqs</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">dq</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">jax.numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">jnp</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">numpy</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">np</span>
<span class="kn">import</span><span class="w"> </span><span class="nn">qontrol</span><span class="w"> </span><span class="k">as</span><span class="w"> </span><span class="nn">ql</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">functools</span><span class="w"> </span><span class="kn">import</span> <span class="n">partial</span>

<span class="n">H1s</span> <span class="o">=</span> <span class="p">[</span><span class="n">dq</span><span class="o">.</span><span class="n">sigmax</span><span class="p">(),</span> <span class="n">dq</span><span class="o">.</span><span class="n">sigmay</span><span class="p">()]</span>
<span class="n">H1_labels</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;X&#39;</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">]</span>


<span class="k">def</span><span class="w"> </span><span class="nf">plot_states</span><span class="p">(</span>
    <span class="n">ax</span><span class="p">:</span> <span class="n">Axes</span><span class="p">,</span>
    <span class="n">expects</span><span class="p">:</span> <span class="n">Array</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">model</span><span class="p">:</span> <span class="n">ql</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span>
    <span class="n">parameters</span><span class="p">:</span> <span class="n">Array</span> <span class="o">|</span> <span class="nb">dict</span><span class="p">,</span>
    <span class="n">which</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Axes</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
    <span class="n">tsave</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">tsave_function</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
    <span class="n">batch_idxs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ndindex</span><span class="p">(</span><span class="o">*</span><span class="n">expects</span><span class="o">.</span><span class="n">shape</span><span class="p">[:</span><span class="o">-</span><span class="mi">3</span><span class="p">])</span>
    <span class="k">for</span> <span class="n">batch_idx</span> <span class="ow">in</span> <span class="n">batch_idxs</span><span class="p">:</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">tsave</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">expects</span><span class="p">[</span><span class="nb">tuple</span><span class="p">(</span><span class="n">batch_idx</span><span class="p">),</span> <span class="n">which</span><span class="p">,</span> <span class="mi">0</span><span class="p">]))</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time [ns]&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span>
        <span class="sa">f</span><span class="s1">&#39;population in $|1</span><span class="se">\\</span><span class="s1">rangle$ for initial state $|</span><span class="si">{</span><span class="n">which</span><span class="si">}</span><span class="se">\\</span><span class="s1">rangle$&#39;</span>
    <span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span>


<span class="k">def</span><span class="w"> </span><span class="nf">plot_controls</span><span class="p">(</span>
    <span class="n">ax</span><span class="p">:</span> <span class="n">Axes</span><span class="p">,</span> <span class="n">_expects</span><span class="p">:</span> <span class="n">Array</span> <span class="o">|</span> <span class="kc">None</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">ql</span><span class="o">.</span><span class="n">Model</span><span class="p">,</span> <span class="n">parameters</span><span class="p">:</span> <span class="n">Array</span> <span class="o">|</span> <span class="nb">dict</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Axes</span><span class="p">:</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_facecolor</span><span class="p">(</span><span class="s1">&#39;none&#39;</span><span class="p">)</span>
    <span class="n">tsave</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">tsave_function</span><span class="p">(</span><span class="n">parameters</span><span class="p">)</span>
    <span class="n">finer_tsave</span> <span class="o">=</span> <span class="n">jnp</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">tsave</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="mi">10</span> <span class="o">*</span> <span class="nb">len</span><span class="p">(</span><span class="n">tsave</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">idx</span><span class="p">,</span> <span class="n">control</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">parameters</span><span class="p">):</span>
        <span class="n">H_c</span> <span class="o">=</span> <span class="n">dq</span><span class="o">.</span><span class="n">pwc</span><span class="p">(</span><span class="n">tsave</span><span class="p">,</span> <span class="n">control</span><span class="p">,</span> <span class="n">H1s</span><span class="p">[</span><span class="n">idx</span><span class="p">])</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
            <span class="n">finer_tsave</span><span class="p">,</span>
            <span class="n">np</span><span class="o">.</span><span class="n">real</span><span class="p">(</span><span class="n">jax</span><span class="o">.</span><span class="n">vmap</span><span class="p">(</span><span class="n">H_c</span><span class="o">.</span><span class="n">prefactor</span><span class="p">)(</span><span class="n">finer_tsave</span><span class="p">))</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">,</span>
            <span class="n">label</span><span class="o">=</span><span class="n">H1_labels</span><span class="p">[</span><span class="n">idx</span><span class="p">],</span>
        <span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">loc</span><span class="o">=</span><span class="s1">&#39;lower right&#39;</span><span class="p">,</span> <span class="n">framealpha</span><span class="o">=</span><span class="mf">0.0</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;pulse amplitude [GHz]&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;time [ns]&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">ax</span>


<span class="n">plotter</span> <span class="o">=</span> <span class="n">ql</span><span class="o">.</span><span class="n">custom_plotter</span><span class="p">(</span>
    <span class="p">[</span>
        <span class="n">plot_controls</span><span class="p">,</span>
        <span class="n">partial</span><span class="p">(</span><span class="n">plot_states</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span>
        <span class="n">partial</span><span class="p">(</span><span class="n">plot_states</span><span class="p">,</span> <span class="n">which</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span>
    <span class="p">]</span>
<span class="p">)</span>
</code></pre></div>
See for example <a href="../examples/qubit">this tutorial</a>.</p>
</details>


    </div>

</div>



  </div>

    </div>

</div><h2 id="file-utilities">File utilities<a class="headerlink" href="#file-utilities" title="Permanent link">¤</a></h2>


<div class="doc doc-object doc-module">




    <div class="doc doc-contents first">










  <div class="doc doc-children">












  </div>

    </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8z"/></svg>
  Back to top
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    
      
      <script id="__config" type="application/json">{"base": "..", "features": ["navigation.tabs", "navigation.sections", "navigation.indexes", "navigation.top", "toc.integrate", "content.code.copy"], "search": "../assets/javascripts/workers/search.973d3a69.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.f55a23d4.min.js"></script>
      
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
      
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
      
    
  </body>
</html>